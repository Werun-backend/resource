# logrusæ—¥å¿—æ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨

## logrusçš„ä¼˜åŠ¿ï¼š

**1.ç»“æ„åŒ–æ—¥å¿—**

æ”¯æŒä»¥é”®å€¼å¯¹å½¢å¼ç»„ç»‡æ—¥å¿—æ•°æ®ï¼Œè¾“å‡º JSON æˆ–è‡ªå®šä¹‰æ ¼å¼ï¼Œä¾¿äºåç»­åˆ†æå’Œè¿‡æ»¤ã€‚

**2.å¤šçº§æ—¥å¿—çº§åˆ«**

æä¾›Traceã€Debugã€Infoã€Warnã€Errorã€Fatalã€Panicä¸ƒä¸ªæ—¥å¿—çº§åˆ«ï¼Œå¯åŠ¨æ€è°ƒæ•´ã€‚

**3.é’©å­ï¼ˆHookï¼‰æœºåˆ¶**

é€šè¿‡é’©å­å¯åœ¨æ—¥å¿—è®°å½•çš„ä¸åŒé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œå¦‚åˆ†çº§å­˜å‚¨ã€å‘Šè­¦è§¦å‘ç­‰ã€‚

**4.å¤šæ ¼å¼è¾“å‡º**

æ”¯æŒæ–‡æœ¬ã€JSON ç­‰æ ¼å¼ï¼Œè¿˜å¯è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨ã€‚

**5.å¤šç›®çš„åœ°è¾“å‡º**

å¯åŒæ—¶å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ã€æ–‡ä»¶ã€è¿œç¨‹æœåŠ¡ç­‰ã€‚

# 1. logrusæ¡†æ¶ä¾èµ–ä¸‹è½½

```go
go get github.com/sirupsen/logrus
```

# 2. logruså¸¸ç”¨æ–¹æ³•

## 2.1.1 å¸¸ç”¨æ–¹æ³•åŠå…¶è¾“å‡º

```go
package main

import "github.com/sirupsen/logrus"

func main() {
	logrus.Error("å‡ºé”™")
	logrus.Warnln("è­¦å‘Š")
	logrus.Infof("ä¿¡æ¯")
	logrus.Debugf("è°ƒè¯•")
	logrus.Println("æ‰“å°")
}

//æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š
time="2025-04-26T14:49:26+08:00" level=error msg="å‡ºé”™"
time="2025-04-26T14:49:26+08:00" level=warning msg="è­¦å‘Š"
time="2025-04-26T14:49:26+08:00" level=info msg="ä¿¡æ¯"
time="2025-04-26T14:49:26+08:00" level=info msg="æ‰“å°"
```

## 2.1.2 logrusæ—¥å¿—ç­‰çº§

<aside>
ğŸ’¡

ä¸ºä»€ä¹ˆDebugfçš„æ—¥å¿—ä¿¡æ¯æ²¡æœ‰è¾“å‡ºå‘¢ï¼Ÿ

å› ä¸ºlogrusé»˜è®¤çš„æ—¥å¿—è¾“å‡ºç­‰çº§æ˜¯infoã€‚

</aside>

```go
fmt.Println(logrus.GetLevel())  //info
```

### æ—¥å¿—ç­‰çº§åˆ’åˆ†

```go
	//çº§åˆ«ä»é«˜åˆ°ä½
	//è®¾ç½®çº§åˆ«ä»¥ä¸Šçš„æ‰€æœ‰çº§åˆ«çš„æ—¥å¿—éƒ½ä¼šè¢«è¾“å‡º
	//æ¯”å¦‚è®¾ç½®äº†æ—¥å¿—çº§åˆ«ä¸ºDebugLevelï¼Œé‚£ä¹ˆä»Panicåˆ°Debugçº§åˆ«çš„æ‰€æœ‰æ—¥å¿—éƒ½ä¼šè¢«è¾“å‡ºï¼Œä½†æ˜¯Traceçº§åˆ«çš„æ—¥å¿—ä¸ä¼šè¢«è¾“å‡º
	PanicLevel    //æœ€é«˜çº§åˆ«ï¼Œé€šå¸¸ç”¨äºä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œè§¦å‘åä¼šè°ƒç”¨ panic()ã€‚
	FatalLevel    //è‡´å‘½é”™è¯¯çº§åˆ«ï¼Œè®°å½•æ—¥å¿—åè°ƒç”¨ os.Exit(1)ï¼Œç¨‹åºé€€å‡ºã€‚
	ErrorLevel    //é”™è¯¯çº§åˆ«ï¼Œè¡¨ç¤ºå¯æ¢å¤çš„é”™è¯¯ï¼Œå¦‚æ–‡ä»¶æ‰“å¼€å¤±è´¥ã€ç½‘ç»œè¯·æ±‚å¤±è´¥ç­‰ã€‚
	WarnLevel     //è­¦å‘Šçº§åˆ«ï¼Œè¡¨ç¤ºæ½œåœ¨é—®é¢˜ï¼Œä½†ä¸æ˜¯ä¸¥é‡é”™è¯¯ï¼Œå¦‚é…ç½®é¡¹ç¼ºå¤±é»˜è®¤å€¼ã€‚
	InfoLevel     //ä¿¡æ¯çº§åˆ«ï¼Œå¸¸è§„è¿è¡Œæ—¥å¿—ï¼Œç”¨äºè®°å½•æ­£å¸¸æµç¨‹ä¸­çš„é‡è¦ä¿¡æ¯ã€‚
	DebugLevel    //è°ƒè¯•çº§åˆ«ï¼Œè¯¦ç»†ä¿¡æ¯ï¼Œé€šå¸¸ç”¨äºå¼€å‘ç¯å¢ƒè°ƒè¯•ç¨‹åºè¡Œä¸ºã€‚
	TraceLevel    //æœ€ä½çº§åˆ«ï¼Œæ¯” Debug æ›´è¯¦ç»†ï¼Œç”¨äºè¿½è¸ªä»£ç æ‰§è¡Œè·¯å¾„æˆ–æ€§èƒ½åˆ†æã€‚       
```

### æ›´æ”¹æ—¥å¿—çº§åˆ«

å¦‚æœä½ æƒ³æ˜¾ç¤ºDebugçº§åˆ«çš„æ—¥å¿—ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ›´æ”¹æ—¥å¿—æ˜¾ç¤ºç­‰çº§

```go
package main

import (
	"github.com/sirupsen/logrus"
)

func main() {
	//è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºDebug
	logrus.SetLevel(logrus.DebugLevel)
	
	logrus.Error("å‡ºé”™")
	logrus.Warnln("è­¦å‘Š")
	logrus.Infof("ä¿¡æ¯")
	logrus.Debugf("è°ƒè¯•")
	logrus.Println("æ‰“å°")
}

//è¾“å‡ºå¦‚ä¸‹
time="2025-04-26T16:56:00+08:00" level=error msg="å‡ºé”™"
time="2025-04-26T16:56:00+08:00" level=warning msg="è­¦å‘Š"
time="2025-04-26T16:56:00+08:00" level=info msg="ä¿¡æ¯"
time="2025-04-26T16:56:00+08:00" level=debug msg="è°ƒè¯•"
time="2025-04-26T16:56:00+08:00" level=info msg="æ‰“å°"
```

æ—¥å¿—çº§åˆ«ä¸€èˆ¬æ˜¯å’Œç³»ç»Ÿç¯å¢ƒæŒ‚é’©ï¼Œä¾‹å¦‚å¼€å‘ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒï¼Œè‚¯å®šå°±è¦æ˜¾ç¤ºdebugä¿¡æ¯ã€‚

çº¿ä¸Šç¯å¢ƒå°±ä¸éœ€è¦è¿™äº›æ—¥å¿—ï¼Œå¯èƒ½åªæ˜¾ç¤ºwarningçš„æ—¥å¿—ã€‚

## 2.1.3 ä¸€äº›è®¾ç½®

### è®¾ç½®ç‰¹å®šå­—æ®µ

```go
package main

import "github.com/sirupsen/logrus"

func main() {
	log1 := logrus.WithField("project", "study")
	log1.Errorln("hello")
	// time="2025-04-26T18:46:56+08:00" level=error msg=hello project=study
	
	log2 := logrus.WithFields(logrus.Fields{
		"project": "study",
		"user":    "admin",
		"time":    "2020-01-01",
	}) 
	log2.Warning("hello")
	// time="2025-04-26T18:46:56+08:00" level=warning msg=hello fields.time=2020-01-01 project=study user=admin
	
	log3 := log2.WithFields(logrus.Fields{
		"id": 1,
	})
	log3.Warning("hello")
}	//time="2025-04-26T18:46:56+08:00" level=warning msg=hello fields.time=2020-01-01 id=1 project=study user=admin
```

é€šå¸¸ï¼Œåœ¨ä¸€ä¸ªåº”ç”¨ä¸­ã€æˆ–è€…åº”ç”¨çš„ä¸€éƒ¨åˆ†ä¸­ï¼Œéƒ½æœ‰ä¸€äº›å›ºå®šçš„Fieldã€‚

æ¯”å¦‚åœ¨å¤„ç†ç”¨æˆ·httpè¯·æ±‚æ—¶ï¼Œä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€æœ‰çš„æ—¥å¿—éƒ½ä¼šæœ‰ request_id å’Œ  user_id

ä¸ºäº†é¿å…æ¯æ¬¡è®°å½•æ—¥å¿—éƒ½è¦ä½¿ç”¨

```go
logrus.WithFields(logrus.Fields{
	"request_id": requesy_id,
	"user_id": user_id
	}
)
```

æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª`logrus.Entry`å®ä¾‹ï¼Œä¸ºè¿™ä¸ªå®ä¾‹è®¾ç½®é»˜è®¤Fieldsï¼Œåœ¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨è¿™ä¸ª`logrus.Entry`å®ä¾‹è®°å½•æ—¥å¿—å³å¯ã€‚

```go
package main

import (
	"github.com/sirupsen/logrus"
)

func main() {
	// åˆ›å»ºä¸€ä¸ª logrus.Logger å®ä¾‹
	logger := logrus.New()

	// è®¾ç½®æ—¥å¿—æ ¼å¼ä¸º JSON æ ¼å¼
	logger.SetFormatter(&logrus.JSONFormatter{})
	
	// ä¸¤ä¸ªå‚æ•°å¯ä»¥ä»ç½‘ç»œè·¯å¾„ä¸­è·å–
	request_id := "1234567890"
	user_id := "1234567890"
	
	// åˆ›å»ºä¸€ä¸ª logrus.Entry å®ä¾‹
	entry := logger.WithFields(logrus.Fields{
		"request_id" : request_id,
		"user_id" : user_id,
	})
	
	entry.Info("hello")
}    
```

<aside>
ğŸ’¡

åœ¨Â `logrus`Â åº“ä¸­ï¼Œ`WithFields`Â æ–¹æ³•ç”¨äºæ·»åŠ é¢å¤–çš„å­—æ®µåˆ°æ—¥å¿—è®°å½•ä¸­ï¼Œè¿™äº›å­—æ®µä¼šåœ¨æ—¥å¿—è¾“å‡ºæ—¶ä¸€åŒæ˜¾ç¤ºã€‚ä¸è¿‡ï¼Œ`logrus`Â æœ¬èº«å¹¶ä¸ä¼šä¿è¯Â `WithFields`Â æ–¹æ³•ä¸­å„å­—æ®µçš„è¾“å‡ºé¡ºåºã€‚

- **åŸå› åˆ†æ**
    
    `logrus`Â åœ¨å¤„ç†æ—¥å¿—å­—æ®µæ—¶ï¼Œé€šå¸¸ä¼šæŠŠè¿™äº›å­—æ®µå­˜å‚¨åœ¨ä¸€ä¸ªÂ `map`Â æ•°æ®ç»“æ„é‡Œã€‚åœ¨ Go è¯­è¨€ä¸­ï¼Œ`map`Â æ˜¯ä¸€ç§æ— åºçš„é”®å€¼å¯¹é›†åˆï¼Œè¿™æ„å‘³ç€Â `map`Â ä¸­çš„å…ƒç´ ä¸ä¼šæŒ‰ç…§æ’å…¥é¡ºåºå­˜å‚¨ï¼Œå› æ­¤åœ¨éå†Â `map`Â æ—¶ï¼Œå…ƒç´ çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚æ‰€ä»¥ï¼Œ`WithFields`Â æ–¹æ³•ä¸­å„å­—æ®µçš„è¾“å‡ºé¡ºåºä¹Ÿå°±æ— æ³•ä¿è¯ã€‚
    
</aside>

### æ˜¾ç¤ºæ ·å¼ Text å’Œ JSON

é»˜è®¤çš„æ˜¯ä»¥ text çš„å½¢å¼å±•ç¤ºï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º JSON

```go
package main

import "github.com/sirupsen/logrus"

func main() {
	logrus.SetFormatter(&logrus.JSONFormatter{})
	log1 := logrus.WithField("key", "value")
	log1.Errorln("Hello World")
}

//è¾“å‡ºå¦‚ä¸‹
{"key":"value","level":"error","msg":"Hello World","time":"2025-04-26T19:18:36+08:00"}
```

### æ§åˆ¶å°ä¸­è‡ªå®šä¹‰é¢œè‰²

å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºé¢œè‰²ï¼Œä¸€èˆ¬çš„åšæ³•éƒ½æ˜¯ä½¿ç”¨ ANSI æ§åˆ¶ç ï¼Œç”¨äºè®¾ç½®æ–‡æœ¬é¢œè‰²ã€‚\033æ˜¯æ§åˆ¶ç çš„å¼€å§‹ï¼Œ\ 033[mæ˜¯æ§åˆ¶ç çš„ç»“æŸï¼Œæ˜¯å…«è¿›åˆ¶æ•°å­—ï¼Œ[31mè¡¨ç¤ºå°†æ–‡æœ¬è®¾ç½®ä¸ºçº¢è‰²ã€‚

ANSIæ§åˆ¶ç æ˜¯ç”¨äºåœ¨ä¸­æ–­å’Œæ§åˆ¶å°ä¸­æ§åˆ¶æ–‡æœ¬æ ¼å¼å’Œé¢œè‰²çš„ä¸€ç§æ ‡å‡†ã€‚å®ƒä»¬é€šå¸¸ç”¨äºåœ¨å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ç¨‹åºä¸­è¾“å‡ºå½©è‰²æ–‡æœ¬æˆ–è€…åœ¨æ–‡æœ¬æ¨¡å¼ä¸‹çš„å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰ä¸­è¾“å‡ºæ–‡æœ¬ã€‚

```go
package main

import "fmt"

func main() {

	//å­—ä½“è‰²
	fmt.Println("\033[30m é»‘è‰² \033[0m")
	fmt.Println("\033[31m çº¢è‰² \033[0m")
	fmt.Println("\033[32m ç»¿è‰² \033[0m")
	fmt.Println("\033[33m é»„è‰² \033[0m")
	fmt.Println("\033[34m è“è‰² \033[0m")
	fmt.Println("\033[35m ç´«è‰² \033[0m")
	fmt.Println("\033[36m é’è‰² \033[0m")
	fmt.Println("\033[37m ç°è‰² \033[0m")

	//èƒŒæ™¯è‰²
	fmt.Println("\033[40m é»‘è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[41m çº¢è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[42m ç»¿è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[43m é»„è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[44m è“è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[45m ç´«è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[46m é’è‰²èƒŒæ™¯ \033[0m")
	fmt.Println("\033[47m ç°è‰²èƒŒæ™¯ \033[0m")

}
```

![è”æƒ³æˆªå›¾_20250426195118.png](%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20250426195118.png)

ä¹Ÿå¯ä»¥è¿™æ ·å†™

```go
fmt.Printf("\x1b[0;%dm%s\x1b[0m", 31, "ä½ å¥½")

// \x1bï¼šè¿™æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œä»£è¡¨ ESC é”®ï¼ˆASCII ç ä¸º 27ï¼‰ï¼Œå®ƒæ˜¯ ANSI è½¬ä¹‰åºåˆ—çš„èµ·å§‹æ ‡è¯†ã€‚
// [0;%dmï¼š0 æ˜¯é»˜è®¤çš„æ˜¾ç¤ºæ¨¡å¼ï¼Œ%d å±äºæ ¼å¼åŒ–å ä½ç¬¦ï¼Œä¼šè¢«åé¢çš„ 31 æ‰€æ›¿ä»£ã€‚31 ä»£è¡¨çº¢è‰²æ–‡å­—ã€‚m åˆ™æ˜¯è½¬ä¹‰åºåˆ—çš„ç»“æŸæ ‡å¿—ã€‚
// %sï¼šåŒæ ·æ˜¯æ ¼å¼åŒ–å ä½ç¬¦ï¼Œä¼šè¢« "ä½ å¥½" æ›¿ä»£ã€‚
// \x1b[0mï¼šæ­¤ä¸ºé‡ç½®è½¬ä¹‰åºåˆ—ï¼Œä½œç”¨æ˜¯æŠŠæ–‡æœ¬é¢œè‰²å’Œæ ·å¼æ¢å¤åˆ°é»˜è®¤çŠ¶æ€ã€‚

//è¾“å‡ºå¦‚ä¸‹ï¼š
ä½ å¥½
```

logrusä¹Ÿæ˜¯æ”¯æŒé¢œè‰²è¾“å‡ºçš„

æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ä¸­å»è¿›è¡Œå¼€å¯

```go
logrus.SetFormatter(&logrus.TextFormatter{ForceColors:true})
```

ä¸è¿‡ï¼Œåªå¼€å¯è¿™ä¸ªå‚æ•°è®¾ç½®çš„è¯ï¼Œè¾“å‡ºä¼šæœ‰äº›å¥‡æ€ªã€‚

```go
package main

import "github.com/sirupsen/logrus"

func main() {
	logrus.SetFormatter(&logrus.TextFormatter{ForceColors: true})
	log1 := logrus.WithField("key", "value")
	log1.Warning("Hello World")
}
```

è¾“å‡ºå¦‚ä¸‹ï¼š

[0000]è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œå³ç¨‹åºå¯åŠ¨åˆ°è¾“å‡ºæ—¥å¿—ç»è¿‡çš„æ—¶é—´ã€‚å› ä¸ºæ²¡æœ‰æ˜¾ç¤ºå®Œæ•´çš„æ—¶é—´æˆ³ã€‚

![è”æƒ³æˆªå›¾_20250426200547.png](%E8%81%94%E6%83%B3%E6%88%AA%E5%9B%BE_20250426200547.png)

è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®

- `SetFomatter`æ–¹æ³•ç›¸å…³é…ç½®
    
    `ForceColors`ï¼šæ˜¯å¦å¼ºåˆ¶ä½¿ç”¨é¢œè‰²è¾“å‡º
    
    `DisableColors`ï¼šæ˜¯å¦ç¦ç”¨é¢œè‰²è¾“å‡º
    
    `ForceQuate`ï¼šæ˜¯å¦å¼ºåˆ¶å¼•ç”¨æ‰€æœ‰å€¼
    
    `DisableTimestamp`ï¼šæ˜¯å¦ç¦ç”¨æ—¶é—´æˆ³ä¿¡æ¯
    
    `FullTimestamp`ï¼šæ˜¯å¦åœ¨è¿æ¥åˆ°TTYæ˜¯è¾“å‡ºå®Œæ•´çš„æ—¶é—´æˆ³
    
    `TimestampFormat`ï¼šç”¨äºè¾“å‡ºå®Œæ•´æ—¶é—´æˆ³çš„æ—¶é—´æˆ³æ ¼å¼
    

ä»£ç ç¤ºä¾‹ï¼š

```go
package main

import "github.com/sirupsen/logrus"

func main() {
  // ForceColorsè¡¨ç¤ºæ˜¯å¦å¼€å¯é¢œè‰²è¾“å‡º
  // TimestampFormatå¯ä»¥è‡ªå®šä¹‰æ—¶é—´æˆ³æ ¼å¼
  // FullTimestampè¡¨ç¤ºæ˜¯å¦å¼€å¯å®Œæ•´æ—¶é—´æˆ³æ˜¾ç¤º
	logrus.SetFormatter(&logrus.TextFormatter{ForceColors: true, TimestampFormat: "2006-01-02 15:04:05", FullTimestamp: true})
	log1 := logrus.WithFields(logrus.Fields{"name": "log1"})
	log1.Info("hello")
}

//è¾“å‡ºï¼šINFO[2025-04-26 20:21:16] hello                     name=log1

```

## 2.1.4 è¾“å‡ºç›®æ ‡æ§åˆ¶

### è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶

é»˜è®¤çš„è¾“å‡ºæ˜¯åœ¨æ§åˆ¶å°ä¸Šï¼Œä½†æ˜¯åæœŸæƒ³è¦æ‰¾åˆ°æŸäº›æ—¥å¿—ï¼Œç¿»æ§åˆ¶å°å¯å°±ä¸å¤ªå¥½æ‰¾äº†ã€‚

ä½¿ç”¨`func SetOutput(out io.Writer)`å³å¯å®ç°è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚åœ¨è¿™ä¹‹å‰å—ï¼Œéœ€è¦æˆ‘ä»¬æœ‰ä¸€ä¸ª`Writer`çš„å¯¹è±¡ã€‚

```go
package main

import (
    "os"
    "github.com/sirupsen/logrus"
)

func main() {
    
    // æ‰“å¼€æ–‡ä»¶ï¼Œä½¿ç”¨ os.O_CREATE|os.O_WRONLY|os.O_APPEND æ ‡å¿—
    // os.O_CREATE æ ‡å¿—ï¼šå¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºè¯¥æ–‡ä»¶ï¼›è‹¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå¯¹å…¶è¿›è¡Œä»»ä½•æ“ä½œã€‚
    // os.O_WRONLY æ ‡å¿—ï¼šä»¥åªå†™æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚
    // os.O_APPEND æ ‡å¿—ï¼šä»¥è¿½åŠ æ¨¡å¼æ‰“å¼€æ–‡ä»¶ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡å†™å…¥æ•°æ®æ—¶ï¼Œæ•°æ®éƒ½ä¼šè¢«è¿½åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œè€Œä¸ä¼šè¦†ç›–åŸæœ‰å†…å®¹ã€‚
    
    file, err := os.OpenFile("info.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
    if err != nil {
        // è‹¥æ–‡ä»¶æ‰“å¼€å¤±è´¥ï¼Œè®°å½•é”™è¯¯ä¿¡æ¯å¹¶é€€å‡ºç¨‹åº
        logrus.Fatalf("Failed to open log file: %v", err)
    }
    
    // ä½¿ç”¨ defer å…³é”®å­—ç¡®ä¿æ–‡ä»¶åœ¨å‡½æ•°ç»“æŸæ—¶å…³é—­
    defer file.Close()

    // è®¾ç½® logrus çš„è¾“å‡ºä¸ºæ‰“å¼€çš„æ–‡ä»¶
    logrus.SetOutput(file)

    // è¾“å‡ºä¸€æ¡æµ‹è¯•æ—¥å¿—
    logrus.Info("This is a test log message.")
}

//è¾“å‡ºç»“æœ
åœ¨ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶info.log
åœ¨info.logæ–‡ä»¶ä¸­å­˜å…¥äº†ä¸€è¡Œæ—¥å¿—ä¿¡æ¯ï¼š
time="2025-04-26T20:30:39+08:00" level=info msg="This is a test log message."
```

<aside>
ğŸ’¡

æ–‡ä»¶å’Œç›®å½•æƒé™çš„è¡¨ç¤ºå½¢å¼ï¼š

### **æƒé™è¡¨ç¤ºè§„åˆ™**

åœ¨è¿™äº›ç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶å’Œç›®å½•çš„æƒé™é€šè¿‡ä¸‰ä½å…«è¿›åˆ¶æ•°æ¥æè¿°ï¼Œä»å·¦åˆ°å³æ¯ä¸€ä½åˆ†åˆ«å¯¹åº”ä¸åŒç”¨æˆ·ç»„çš„æƒé™ï¼š

- ç¬¬ä¸€ä½ä»£è¡¨æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆuserï¼‰çš„æƒé™ã€‚
- ç¬¬äºŒä½ä»£è¡¨æ–‡ä»¶æ‰€å±ç»„ï¼ˆgroupï¼‰çš„æƒé™ã€‚
- ç¬¬ä¸‰ä½ä»£è¡¨å…¶ä»–ç”¨æˆ·ï¼ˆothersï¼‰çš„æƒé™ã€‚

è€Œæ¯ä¸€ä½å…«è¿›åˆ¶æ•°åˆç”±ä¸‰ä¸ªäºŒè¿›åˆ¶ä½ç»„æˆï¼Œåˆ†åˆ«å¯¹åº”è¯»ï¼ˆ`r`ï¼‰ã€å†™ï¼ˆ`w`ï¼‰ã€æ‰§è¡Œï¼ˆ`x`ï¼‰æƒé™ï¼Œå…¶å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š

- è¯»æƒé™ï¼ˆ`r`ï¼‰ï¼šäºŒè¿›åˆ¶ä¸ºÂ `100`ï¼Œå…«è¿›åˆ¶ä¸ºÂ `4`ã€‚
- å†™æƒé™ï¼ˆ`w`ï¼‰ï¼šäºŒè¿›åˆ¶ä¸ºÂ `010`ï¼Œå…«è¿›åˆ¶ä¸ºÂ `2`ã€‚
- æ‰§è¡Œæƒé™ï¼ˆ`x`ï¼‰ï¼šäºŒè¿›åˆ¶ä¸ºÂ `001`ï¼Œå…«è¿›åˆ¶ä¸ºÂ `1`ã€‚

### **`0666`Â æƒé™è§£æ**

ä¸‰è€…éƒ½æœ‰è¯»å†™æƒé™ï¼Œä½†æ²¡æœ‰æ‰§è¡Œæƒé™

</aside>

### åŒæ—¶è¾“å‡ºåˆ°å±å¹•å’Œæ–‡ä»¶

```go
package main

import (
	"github.com/sirupsen/logrus"
	"io"
	"os"
)

func main() {
	logrus.SetFormatter(&logrus.TextFormatter{})
	logrus.SetOutput(os.Stdout)
	// è®¾ç½®outputï¼Œé»˜è®¤ä¸ºStderrï¼Œå¯ä»¥ä¸ºä»»ä½•io.Writerï¼Œæ¯”å¦‚æ–‡ä»¶*os.File
	file, _ := os.OpenFile("checkemstools.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
	writers := []io.Writer{
		file,
		os.Stdout,
	}
	// åŒæ—¶å†™æ–‡ä»¶å’Œå±å¹•
	fileAndStdoutWriter := io.MultiWriter(writers...)
	logrus.SetOutput(fileAndStdoutWriter)
	log1 := logrus.WithFields(logrus.Fields{"date": "2019-01-01", "user": "admin"})
	log1.Info("this is a logrus info")
}

//è¾“å‡ºå†…å®¹ï¼š
åœ¨ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ–‡ä»¶checkemstools.log
åœ¨checkemstools.logæ–‡ä»¶ä¸­å­˜å…¥äº†ä¸€è¡Œæ—¥å¿—ä¿¡æ¯ï¼š
time="2025-04-26T21:04:01+08:00" level=info msg="this is a logrus info" date=2019-01-01 user=admin
åœ¨æ§åˆ¶å°è¾“å‡ºäº†æ—¥å¿—ä¿¡æ¯ï¼š
time="2025-04-26T21:04:01+08:00" level=info msg="this is a logrus info" date=2019-01-01 user=admin
```

### è‡ªå®šä¹‰æ ¼å¼

```go
package main

import (
	"bytes"
	"fmt"
	"github.com/sirupsen/logrus"
	"os"
	"path"
)

// é¢œè‰²ä»£ç ï¼ˆè®¾ç½®èƒŒæ™¯è‰²ä»¥4å¼€å¤´ï¼Œè®¾ç½®å­—ä½“è‰²ä»¥3å¼€å¤´ï¼‰
const (
	ccBlack  = 0
	ccRed    = 1
	ccGreen  = 2
	ccYellow = 3
	ccBlue   = 4
	ccPurple = 5
	ccCyan   = 6
	ccWhite  = 7
)

type MyFormatter struct {
	Prefix     string //å‰ç¼€å­—æ®µ
	TimeFormat string //æ—¶é—´æ ¼å¼å­—æ®µ
}

func (f MyFormatter) Format(entry *logrus.Entry) ([]byte, error) {

	// è®¾ç½®é¢œè‰²
	var color int

	switch entry.Level {
	case logrus.ErrorLevel:
		color = ccRed
	case logrus.WarnLevel:
		color = ccYellow
	case logrus.InfoLevel:
		color = ccGreen
	case logrus.DebugLevel:
		color = ccBlue
	default:
		color = ccWhite
	}

	// è®¾ç½® buffer ç¼“å†²åŒº
	var b *bytes.Buffer

	// åˆ¤æ–­ç¼“å†²åŒºæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™å¼€è¾Ÿä¸€å—æ–°å†…å­˜ï¼Œä¸ä¸ºç©ºåˆ™ç›´æ¥èµ‹å€¼
	if entry.Buffer != nil {
		b = entry.Buffer
	} else {
		b = &bytes.Buffer{}
	}

	// æ—¶é—´æ ¼å¼åŒ–
	formatTime := entry.Time.Format(f.TimeFormat)

	// åˆ¤æ–­æ˜¯å¦è®¾ç½®äº†è°ƒç”¨è€…ä¿¡æ¯ï¼ˆæ˜¯å¦å­˜åœ¨è°ƒç”¨æ—¥å¿—è®°å½•å‡½æ•°çš„ä»£ç ä½ç½®ï¼‰
	if entry.HasCaller() {
		// è‡ªå®šä¹‰æ–‡ä»¶è·¯å¾„
		// å‡½æ•°åç§°
		funcVal := entry.Caller.Function
		// æ–‡ä»¶è·¯å¾„å’Œè¡Œå·ã€‚  path.Baseæ–¹æ³•ç”¨äºæ˜¾ç¤ºä¸é‡å¤çš„è·¯å¾„ï¼Œç®€åŒ–è¾“å‡º
		fileVal := fmt.Sprintf("%s:%d", path.Base(entry.Caller.File), entry.Caller.Line)
		// è¾“å‡ºæ ¼å¼åŒ–
		fmt.Fprintf(b, "[%s] \033[3%dm[%s]\033[0m [%s] %s %s %s\n", f.Prefix, color, entry.Level, formatTime, fileVal, funcVal, entry.Message)
	} else {
		fmt.Fprintf(b, "[%s] \033[3%dm[%s]\033[0m [%s] %s\n", f.Prefix, color, entry.Level, formatTime, entry.Message)
	}
	return b.Bytes(), nil
}

var log *logrus.Logger

// åˆå§‹åŒ–æ—¥å¿—ï¼Œéšå¼è°ƒç”¨
func init() {
	log = NewLog()
}

func NewLog() *logrus.Logger {
	//æ–°å»ºä¸€ä¸ªå®ä¾‹
	mLog := logrus.New()                                                               
	//è®¾ç½®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
	mLog.SetOutput(os.Stdout)                                                          
	//å¼€å¯è¿”å›å‡½æ•°åå’Œè¡Œå·ï¼ˆå³å¼€å¯è°ƒç”¨è€…ä¿¡æ¯ï¼‰
	mLog.SetReportCaller(true)                                                        
	//è®¾ç½®æ—¥å¿—çº§åˆ«
	mLog.SetLevel(logrus.DebugLevel)                                                   
	//è®¾ç½®æ ¼å¼
	mLog.SetFormatter(&MyFormatter{Prefix: "GORM", TimeFormat: "2006-01-02 15:04:05"}) 

	return mLog
}
func main() {
	log.Debug("debug")
	log.Info("info")
	log.Warn("warn")
	log.Error("error")
}
```

<aside>
ğŸ’¡

`bytes.buffer`ç¼“å†²åŒºçš„ä½œç”¨ï¼š

- **1. æ€§èƒ½ä¼˜åŒ–**
    
    æ—¥å¿—è®°å½•æ—¶ï¼Œé¢‘ç¹çš„ I/O æ“ä½œï¼ˆå¦‚å°†æ—¥å¿—å†…å®¹å†™å…¥æ–‡ä»¶æˆ–æ ‡å‡†è¾“å‡ºï¼‰ä¼šæ¶ˆè€—è¾ƒå¤šçš„ç³»ç»Ÿèµ„æºï¼Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ç¼“å†²åŒºèƒ½å°†å¤šæ¬¡å°çš„å†™å…¥æ“ä½œåˆå¹¶æˆä¸€æ¬¡å¤§çš„å†™å…¥æ“ä½œï¼Œå‡å°‘ I/O æ“ä½œçš„æ¬¡æ•°ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚
    
    åœ¨ä»£ç é‡Œï¼Œ`bytes.Buffer`ä¼šå…ˆæŠŠæ—¥å¿—å†…å®¹å­˜å‚¨èµ·æ¥ï¼Œç›´åˆ°æ—¥å¿—æ ¼å¼åŒ–å®Œæˆï¼Œå†ä¸€æ¬¡æ€§æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆ`os.Stdout`ï¼‰ï¼Œä»¥æ­¤å‡å°‘ä¸æ ‡å‡†è¾“å‡ºçš„äº¤äº’æ¬¡æ•°ã€‚
    
- **2. çµæ´»æ€§ä¸å¯å¤ç”¨æ€§**
    
    
    - **æ–¹ä¾¿æ ¼å¼åŒ–æ“ä½œ**ï¼š`bytes.Buffer`æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œåƒ`Write`ã€`WriteString`ã€`WriteByte`ç­‰ï¼Œä¾¿äºè¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥å’Œæ ¼å¼åŒ–æ“ä½œã€‚åœ¨ä»£ç ä¸­ï¼Œå€ŸåŠ©`fmt.Fprintf`å‡½æ•°æŠŠæ ¼å¼åŒ–åçš„æ—¥å¿—å†…å®¹å†™å…¥`bytes.Buffer`ï¼Œè¿™æ ·å°±èƒ½å¾ˆæ–¹ä¾¿åœ°ç»„åˆä¸åŒçš„æ—¥å¿—ä¿¡æ¯ã€‚
    
    - **é¿å…é‡å¤åˆ†é…å†…å­˜**ï¼šä½¿ç”¨`bytes.Buffer`èƒ½å¤Ÿé¿å…åœ¨æ¯æ¬¡å†™å…¥æ—¥å¿—æ—¶éƒ½é‡æ–°åˆ†é…å†…å­˜ã€‚å› ä¸º`bytes.Buffer`å¯ä»¥åŠ¨æ€è°ƒæ•´å…¶å®¹é‡ï¼Œæ‰€ä»¥åœ¨å¤šæ¬¡å†™å…¥æ—¥å¿—æ—¶ï¼Œå¯å¤ç”¨å·²åˆ†é…çš„å†…å­˜ç©ºé—´ã€‚
    
</aside>

# 3. Hook

`logrus`æœ€ä»¤äººå¿ƒåŠ¨çš„åŠŸèƒ½å°±æ˜¯å…¶å¯æ‰©å±•çš„`HOOK`æœºåˆ¶äº†ï¼Œé€šè¿‡åœ¨åˆå§‹åŒ–æ—¶ä¸º`logrus`æ·»åŠ `hook`ï¼Œ`logrus`å¯ä»¥å®ç°å„ç§æ‰©å±•åŠŸèƒ½ã€‚

## 3.1 Hookçš„æ¥å£å®šä¹‰å½¢å¼

```go
// Levels() æ–¹æ³•ç”¨äºæŒ‡å®šè¯¥é’©å­ï¼ˆHookï¼‰ä¼šåº”ç”¨äºå“ªäº›æ—¥å¿—çº§åˆ«
// Fire(*Entry) error æ–¹æ³•æ˜¯é’©å­çš„æ ¸å¿ƒé€»è¾‘æ‰€åœ¨
type Hook interface {
	Levels() []logrus.Level
	Fire(*Entry) error
}
```

## 3.2 Hookçš„æ¥å£å®ç°æ¡ˆä¾‹

### 3.2.1 å†™å…¥ä¸€ä¸ªå…¬ç”¨å­—æ®µ

ä¾‹å¦‚å®ç°ï¼šæ¯æ¡æ—¥å¿—éƒ½åŠ å…¥ä¸€ä¸ª`field` å…¬ç”¨å­—æ®µ

æˆ‘ä»¬éœ€è¦å®ç°ä¸¤ä¸ªæ–¹æ³•ä»¥å®ç°`Hook`æ¥å£

```go
package main

import (
	"github.com/sirupsen/logrus"
)

type MyHook struct {
}

// è®¾ç½®logrusæ—¥å¿—ç­‰çº§ä¸ºæ‰€æœ‰ç­‰çº§éƒ½å¯è¾“å‡º
func (hook MyHook) Levels() []logrus.Level {
	return logrus.AllLevels
}

// è®¾ç½®ä¸€ä¸ªfield
func (hook MyHook) Fire(entry *logrus.Entry) error {
	entry.Data["cc"] = "cc"
	return nil
}

func main() {
	logrus.AddHook(&MyHook{})

	logrus.Warnln("test")
	logrus.Errorf("test")
}

//è¾“å‡ºå¦‚ä¸‹
//æ‰€æœ‰çš„æ—¥å¿—è®°å½•ä¸­éƒ½ä¼šæœ‰cc=ccè¿™ä¸ªHookæ·»åŠ çš„field
time="2025-04-29T16:41:42+08:00" level=warning msg=test cc=cc
time="2025-04-29T16:41:42+08:00" level=error msg=test cc=cc
```

### 3.2.2 å®ç°å¤šæ–‡ä»¶å†™å…¥

`logrus hook`  æ˜¯ä¸€ä¸ªå€¼å¾—æ·±å…¥å­¦ä¹ çš„è®¾è®¡ï¼Œä½ å¯ä»¥è½»æ˜“ä½¿ç”¨hookæ¥å®ç°å¤šæ–‡ä»¶å†™å…¥ã€‚

æ¯”å¦‚ï¼Œ`error`çº§åˆ«çš„æ—¥å¿—ç‹¬ç«‹è¾“å‡ºåˆ°`error.log`æ–‡ä»¶é‡Œï¼Œå…¶ä»–éƒ½æ”¾åœ¨ä¸€èµ·ã€‚

```go
package main

import (
	"fmt"
	"github.com/sirupsen/logrus"
	"os"
)

// ä¼ å…¥ä¸€ä¸ªå†™å…¥å™¨ï¼Œç”¨äºå‘æ–‡ä»¶ä¸­å†™å…¥æ—¥å¿—ä¿¡æ¯
type MyHook struct {
	Writer *os.File
}

// è®¾ç½®logrusçš„levelä¸ºErrorLevelï¼Œåªæœ‰æ—¥å¿—çº§åˆ«ä¸ºErrorçš„æ—¥å¿—æ‰èƒ½è¢«è¾“å‡º
func (hook MyHook) Levels() []logrus.Level {
	return []logrus.Level{logrus.ErrorLevel}
}

func (hook MyHook) Fire(entry *logrus.Entry) error {
	// å°†æ—¥å¿—æ¡ç›®è½¬æ¢ä¸ºå­—ç¬¦ä¸²
	line, err := entry.String()
	if err != nil {
	  // å¦‚æœè½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯æµ
		fmt.Fprintf(os.Stderr, "Unable to read entry: %v\n", err)
		return err
	}
	// å°†è½¬æ¢åçš„æ—¥å¿—æ¡ç›®å­—ç¬¦ä¸²å†™å…¥åˆ°æŒ‡å®šçš„ Writer ä¸­
	hook.Writer.Write([]byte(line))
	return nil
}

func main() {
	// è®¾ç½®æ—¥å¿—æ ¼å¼
	logrus.SetFormatter(&logrus.TextFormatter{ForceColors: true, TimestampFormat: "2006-01-02 15:04:05", FullTimestamp: true})
	// å¼€å¯è¿”å›å‡½æ•°åå’Œè¡Œå·
	logrus.SetReportCaller(true)
	// åˆ›å»ºéœ€è¦å†™å…¥çš„æ–‡ä»¶
	file, _ := os.OpenFile("err.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
	hook := &MyHook{Writer: file}
	logrus.AddHook(hook)
	logrus.Errorf("text")
}

//è¾“å‡ºå¦‚ä¸‹
åœ¨æ§åˆ¶å°ä¸­ï¼š
ERRO[2025-04-29 16:52:38]D:/develop/awesomeProject/main.go:33 main.main() text   
å·¥ä½œç›®å½•ä¸‹è‡ªåŠ¨æ–°å»ºäº†ä¸€ä¸ªæ–‡ä»¶err.logï¼Œå¹¶åœ¨å…¶ä¸­å†™å…¥æ—¥å¿—ï¼ˆæ–‡ä»¶ä¸­ä¸èƒ½ä½¿ç”¨ANSIé¢œè‰²ç ï¼‰ï¼š
[31mERRO[0m[2025-04-29 16:52:38]D:/develop/awesomeProject/main.go:33 main.main() text
```

# 4. æ—¥å¿—åˆ†å‰²

## 4.1 æŒ‰æ—¶é—´åˆ†å‰²

### 4.1.1 ä¸€èˆ¬æ–¹æ³•

```go
package main

import (
	"errors"
	"fmt"
	log "github.com/sirupsen/logrus"
	"io"
	"os"
	"path/filepath"
	"time"
)

// LogFormatter è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼åŒ–å™¨ç»“æ„ä½“
type LogFormatter struct {
}

// Format å®ç° logrus.Formatter æ¥å£çš„ Format æ–¹æ³•ï¼Œç”¨äºæ ¼å¼åŒ–æ—¥å¿—æ¡ç›®
func (s *LogFormatter) Format(entry *log.Entry) ([]byte, error) {
	// è·å–å½“å‰æ—¶é—´å¹¶æ ¼å¼åŒ–
	timestamp := time.Now().Format("2006-01-02 15:04:05")
	// å®šä¹‰æ–‡ä»¶åå’Œè¡Œå·å˜é‡
	var file string
	var len int
	// æ£€æŸ¥æ—¥å¿—æ¡ç›®æ˜¯å¦åŒ…å«è°ƒç”¨è€…ä¿¡æ¯
	if entry.Caller != nil {
		// è·å–è°ƒç”¨è€…æ–‡ä»¶çš„åŸºæœ¬åç§°
		file = filepath.Base(entry.Caller.File)
		// è·å–è°ƒç”¨è€…æ–‡ä»¶çš„è¡Œå·
		len = entry.Caller.Line
	}
	// æŒ‰ç…§æŒ‡å®šæ ¼å¼æ‹¼æ¥æ—¥å¿—ä¿¡æ¯
	msg := fmt.Sprintf("[%s] [%s] [%s:%d] %s\n", timestamp, entry.Level, file, len, entry.Message)
	// å°†æ‹¼æ¥å¥½çš„æ—¥å¿—ä¿¡æ¯è½¬æ¢ä¸ºå­—èŠ‚åˆ‡ç‰‡å¹¶è¿”å›
	return []byte(msg), nil
}

// logFileWriter è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶å†™å…¥å™¨ç»“æ„ä½“
type logFileWriter struct {
	file     *os.File  // æ‰“å¼€çš„æ—¥å¿—æ–‡ä»¶å¥æŸ„
	logPath  string    // æ—¥å¿—æ–‡ä»¶å­˜å‚¨çš„æ ¹è·¯å¾„
	fileDate string    // å½“å‰æ—¥å¿—æ–‡ä»¶å¯¹åº”çš„æ—¥æœŸ
	appName  string    // åº”ç”¨ç¨‹åºçš„åç§°
}

// Write å®ç° io.Writer æ¥å£çš„ Write æ–¹æ³•ï¼Œç”¨äºå°†æ—¥å¿—æ•°æ®å†™å…¥æ–‡ä»¶
func (p *logFileWriter) Write(data []byte) (n int, err error) {
	// æ£€æŸ¥ logFileWriter å®ä¾‹æ˜¯å¦ä¸ºç©º
	if p == nil {
		return 0, errors.New("logFileWriter is nil")
	}
	// æ£€æŸ¥æ–‡ä»¶å¥æŸ„æ˜¯å¦ä¸ºç©º
	if p.file == nil {
		return 0, errors.New("file not opened")
	}

	// è·å–å½“å‰æ—¥æœŸå¹¶æ ¼å¼åŒ–ä¸º "2006-01-02" æ ¼å¼
	fileDate := time.Now().Format("2006-01-02")
	// åˆ¤æ–­å½“å‰æ—¥æœŸæ˜¯å¦ä¸ä¹‹å‰è®°å½•çš„æ—¥æœŸä¸åŒ
	if fileDate != p.fileDate {
		// è‹¥æ—¥æœŸä¸åŒï¼Œå…³é—­å½“å‰æ‰“å¼€çš„æ–‡ä»¶
		p.file.Close()
		// åˆ›å»ºæ–°æ—¥æœŸå¯¹åº”çš„æ—¥å¿—ç›®å½•
		err = os.MkdirAll(fmt.Sprintf("%s/%s", p.logPath, fileDate), os.ModePerm)
		if err != nil {
			return 0, err
		}
		// ç”Ÿæˆæ–°æ—¥æœŸå¯¹åº”çš„æ—¥å¿—æ–‡ä»¶å
		filename := fmt.Sprintf("%s/%s/%s-%s.log", p.logPath, fileDate, p.appName, fileDate)

		// ä»¥åˆ›å»ºã€è¿½åŠ å†™å…¥æ¨¡å¼æ‰“å¼€æ–°çš„æ—¥å¿—æ–‡ä»¶
		p.file, err = os.OpenFile(filename, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
		if err != nil {
			return 0, err
		}
		// æ›´æ–°è®°å½•çš„æ—¥æœŸ
		p.fileDate = fileDate
	}

	// å°†æ—¥å¿—æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œå¹¶è¿”å›å†™å…¥çš„å­—èŠ‚æ•°å’Œå¯èƒ½çš„é”™è¯¯
	n, e := p.file.Write(data)
	return n, e
}

// InitLog åˆå§‹åŒ–æ—¥å¿—é…ç½®ï¼ŒåŒ…æ‹¬åˆ›å»ºæ—¥å¿—æ–‡ä»¶ã€è®¾ç½®è¾“å‡ºå’Œæ ¼å¼åŒ–å™¨ç­‰
func InitLog(logPath string, appName string) {
	// è·å–å½“å‰æ—¥æœŸå¹¶æ ¼å¼åŒ–ä¸º "2006-01-02" æ ¼å¼
	fileDate := time.Now().Format("2006-01-02")
	// åˆ›å»ºå½“å‰æ—¥æœŸå¯¹åº”çš„æ—¥å¿—ç›®å½•ï¼Œos.ModePerm çš„å€¼æ˜¯ 0777
	err := os.MkdirAll(fmt.Sprintf("%s/%s", logPath, fileDate), os.ModePerm)
	if err != nil {
		log.Error(err)
		return
	}

	// ç”Ÿæˆå½“å‰æ—¥æœŸå¯¹åº”çš„æ—¥å¿—æ–‡ä»¶å
	filename := fmt.Sprintf("%s/%s/%s-%s.log", logPath, fileDate, appName, fileDate)
	file, err := os.OpenFile(filename, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	if err != nil {
		log.Error(err)
		return
	}

	// åˆ›å»º logFileWriter å®ä¾‹
	fileWriter := logFileWriter{file, logPath, fileDate, appName}
	// é»˜è®¤è®¾ç½®æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
	log.SetOutput(os.Stdout)
	// å®šä¹‰ä¸€ä¸ªå†™å…¥å™¨åˆ‡ç‰‡ï¼ŒåŒ…å«æ–‡ä»¶å†™å…¥å™¨å’Œæ ‡å‡†è¾“å‡ºå†™å…¥å™¨
	writers := []io.Writer{
		&fileWriter,
		os.Stdout,
	}
	// åˆ›å»ºä¸€ä¸ªå¤šå†™å…¥å™¨ï¼Œå¯åŒæ—¶å°†æ—¥å¿—å†™å…¥æ–‡ä»¶å’Œæ ‡å‡†è¾“å‡º
	fileAndStdoutWriter := io.MultiWriter(writers...)
	if err == nil {
		log.SetOutput(fileAndStdoutWriter)
	} else {
		log.Info("Fail to log into file, using default stderr")
	}
	log.SetReportCaller(true)
	log.SetFormatter(new(LogFormatter))
}

func main() {
	InitLog("awesomeProject/logs/", "test")
	log.Errorf("test")
	log.Infof("test")
	log.Warnln("test")
	log.Debugf("test")
}

//è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

åœ¨æ§åˆ¶å°ä¸­è¾“å‡ºäº†æ—¥å¿—ï¼š
[2025-05-04 10:56:39] [error] [main.go:100] test
[2025-05-04 10:56:39] [info] [main.go:101] test
[2025-05-04 10:56:39] [warning] [main.go:102] test

åœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å»ºäº†ä¸€ä¸ªlogsæ–‡ä»¶å¤¹
åœ¨logsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹2025-05-04
åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ–‡ä»¶test-2025-05-04.log
æ–‡ä»¶ä¸­å­˜æ”¾äº†ä¸‰æ¡æ—¥å¿—ï¼š
[2025-05-04 10:56:39] [error] [main.go:100] test
[2025-05-04 10:56:39] [info] [main.go:101] test
[2025-05-04 10:56:39] [warning] [main.go:102] test
åœ¨åŒä¸€å¤©äºŒæ¬¡è¿è¡Œç¨‹åºåï¼Œæ–‡ä»¶ä¸­ä¼šæ–°å¢ä¸‰æ¡æ—¥å¿—ï¼Œä¸ä¼šè¦†ç›–åŸæœ‰çš„æ—¥å¿—ã€‚
ä¸åœ¨åŒä¸€å¤©è¿è¡Œç¨‹åºåï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¹¶åœ¨å…¶ä¸­å­˜æ”¾å½“å¤©çš„æ—¥å¿—ã€‚
è¿™æ ·å°±å®ç°äº†æ—¥å¿—æŒ‰æ—¶é—´åˆ†å‰²ã€‚
```

### 4.1.2 åˆ©ç”¨hookå®ç°æ—¶é—´åˆ†å‰²

```go
package main

import (
	"fmt"
	"github.com/sirupsen/logrus"
	"os"
	"time"
)

type FileDateHook struct {
	file     *os.File
	logPath  string
	fileDate string
	appName  string
}

func (hook FileDateHook) Levels() []logrus.Level {
	return logrus.AllLevels
}

func (hook FileDateHook) Fire(entry *logrus.Entry) error {
  //æŒ‰æ¯åˆ†é’Ÿä½œä¸ºæ–‡ä»¶åˆ†å‰²ç‚¹
	timer := entry.Time.Format("2006-01-02_15-04")
	line, _ := entry.String()
	if hook.fileDate == timer {
		hook.file.Write([]byte(line))
		return nil
	}
	//æ—¶é—´ä¸ç­‰
	hook.file.Close()
	os.MkdirAll(fmt.Sprintf("%s/%s", hook.logPath, timer), os.ModePerm)
	filename := fmt.Sprintf("%s/%s/%s.log", hook.logPath, timer, hook.appName)

	hook.file, _ = os.OpenFile(filename, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	hook.fileDate = timer
	hook.file.Write([]byte(line))
	return nil
}

func InitFile(logPath, appName string) {
	fileDate := time.Now().Format("2006-01-02_15-04")
	// åˆ›å»ºæ—¥å¿—ç›®å½•
	err := os.MkdirAll(fmt.Sprintf("%s/%s", logPath, fileDate), os.ModePerm)
	if err != nil {
		logrus.Error(err)
		return
	}

	filename := fmt.Sprintf("%s/%s/%s.log", logPath, fileDate, appName)
	file, err := os.OpenFile(filename, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	if err != nil {
		logrus.Error(err)
		return
	}
	filehook := FileDateHook{file: file, logPath: logPath, fileDate: fileDate, appName: appName}
	logrus.AddHook(&filehook)
}

func main() {
	InitFile("./log", "test")
	for {
		logrus.Errorf("test")
		time.Sleep(10 * time.Second)
		logrus.Infof("test")
	}
}
```

## 4.2 æŒ‰æ—¥å¿—ç­‰çº§åˆ†å‰²

æ—¥å¿—ç­‰çº§ï¼šerror,warn,info,all.log

```go
package main

import (
	"fmt"
	"github.com/sirupsen/logrus"
	"os"
)

const (
	allLog  = "all"
	errLog  = "err"
	warnLog = "warn"
	infoLog = "info"
)

type FileLevelHook struct {
	file     *os.File
	errFile  *os.File
	warnFile *os.File
	infoFile *os.File
	logPath  string
}

func (hook *FileLevelHook) Levels() []logrus.Level {
	return logrus.AllLevels
}

func (hook *FileLevelHook) Fire(entry *logrus.Entry) error {
	line, _ := entry.String()
	switch entry.Level {
	case logrus.ErrorLevel:
		hook.errFile.Write([]byte(line))
	case logrus.WarnLevel:
		hook.warnFile.Write([]byte(line))
	case logrus.InfoLevel:
		hook.infoFile.Write([]byte(line))
	}
	hook.file.Write([]byte(line))
	return nil
}

func InitLevel(logPath string) {
	err := os.MkdirAll(fmt.Sprintf("%s", logPath), os.ModePerm)
	if err != nil {
		logrus.Errorf("create log path error: %v", err)
		return
	}

	allFile, err := os.OpenFile(fmt.Sprintf("%s/%s.log", logPath, allLog), os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	errFile, err := os.OpenFile(fmt.Sprintf("%s/%s.log", logPath, errLog), os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	warnFile, err := os.OpenFile(fmt.Sprintf("%s/%s.log", logPath, warnLog), os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	infoFile, err := os.OpenFile(fmt.Sprintf("%s/%s.log", logPath, infoLog), os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	fileHook := FileLevelHook{allFile, errFile, warnFile, infoFile, logPath}
	logrus.AddHook(&fileHook)
}

func main() {
	InitLevel("log_level")

	logrus.Errorf("hello")
	logrus.Errorln("error")
	logrus.Warnf("warn")
	logrus.Infof("info")
	logrus.Printf("print")

}

```

# 5.giné›†æˆlogrus

### main.go

```go
package main

import (
	"awesomeProject/gin_logrus/log"
	"awesomeProject/gin_logrus/middleware"
	"github.com/gin-gonic/gin"
	"github.com/sirupsen/logrus"
)

func main() {
	router := gin.New()
	router.Use(middleware.LogMiddleware())
	log.InitFile("gin_logrus/logs", "server")

	router.GET("/", func(c *gin.Context) {
		logrus.Info("hello")
		c.JSON(200, gin.H{
			"message": "hello",
		})
	})

	router.Run(":8081")
}
```

### log.go

```go
package log

import (
	"fmt"
	"github.com/sirupsen/logrus"
	"os"
	"time"
)

type FileDateHook struct {
	file     *os.File
	logPath  string
	fileDate string
	appName  string
}
func (hook FileDateHook) Levels() []logrus.Level {
	return logrus.AllLevels
}

func (hook FileDateHook) Fire(entry *logrus.Entry) error {
	timer := entry.Time.Format("2006-01-02_15-04")
	line, _ := entry.String()
	if hook.fileDate == timer {
		hook.file.Write([]byte(line))
		return nil
	}
	//æ—¶é—´ä¸ç­‰
	hook.file.Close()
	os.MkdirAll(fmt.Sprintf("%s/%s", hook.logPath, timer), os.ModePerm)
	filename := fmt.Sprintf("%s/%s/%s.log", hook.logPath, timer, hook.appName)

	hook.file, _ = os.OpenFile(filename, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	hook.fileDate = timer
	hook.file.Write([]byte(line))
	return nil
}

func InitFile(logPath, appName string) {
	fileDate := time.Now().Format("2006-01-02_15-04")
	// åˆ›å»ºæ—¥å¿—ç›®å½•
	err := os.MkdirAll(fmt.Sprintf("%s/%s", logPath, fileDate), os.ModePerm)
	if err != nil {
		logrus.Error(err)
		return
	}

	filename := fmt.Sprintf("%s/%s/%s.log", logPath, fileDate, appName)
	file, err := os.OpenFile(filename, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0600)
	if err != nil {
		logrus.Error(err)
		return
	}
	filehook := FileDateHook{file: file, logPath: logPath, fileDate: fileDate, appName: appName}
	logrus.AddHook(&filehook)
}
```

### log_middle.go

```go
package middleware

import (
	"github.com/gin-gonic/gin"
	"github.com/sirupsen/logrus"
	"time"
)

func LogMiddleware() gin.HandlerFunc {
	return func(c *gin.Context) {
		start := time.Now()
		path := c.Request.URL.Path
		raw := c.Request.URL.RawQuery
		c.Next()
		end := time.Now()
		timeSub := end.Sub(start)
		clientIP := c.ClientIP()
		method := c.Request.Method
		statusCode := c.Writer.Status()
		if raw != "" {
			path = path + "?" + raw
		}

		logrus.Infof("[GIN] %s | %d | %d | %s | %s | %s",
			start.Format("2006-01-02 15:04:05"),
			statusCode,
			timeSub,
			clientIP,
			method,
			path,
		)
	}
}
```